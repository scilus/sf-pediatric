Changes in component 'nf-neuro/output_template_space'
'subworkflows/nf-neuro/output_template_space/meta.yml' is unchanged
Changes in 'output_template_space/main.nf':
--- subworkflows/nf-neuro/output_template_space/main.nf
+++ subworkflows/nf-neuro/output_template_space/main.nf
@@ -5,6 +5,7 @@
 include { BETCROP_FSLBETCROP as BET_T2W                 } from '../../../modules/nf-neuro/betcrop/fslbetcrop/main.nf'
 include { REGISTRATION_ANTS                             } from '../../../modules/nf-neuro/registration/ants/main.nf'
 include { REGISTRATION_ANTSAPPLYTRANSFORMS as WARPIMAGES} from '../../../modules/nf-neuro/registration/antsapplytransforms/main.nf'
+include { REGISTRATION_ANTSAPPLYTRANSFORMS as WARPRGB   } from '../../../modules/nf-neuro/registration/antsapplytransforms/main.nf'
 include { REGISTRATION_ANTSAPPLYTRANSFORMS as WARPMASK  } from '../../../modules/nf-neuro/registration/antsapplytransforms/main.nf'
 include { REGISTRATION_ANTSAPPLYTRANSFORMS as WARPLABELS} from '../../../modules/nf-neuro/registration/antsapplytransforms/main.nf'
 include { REGISTRATION_TRACTOGRAM                       } from '../../../modules/nf-neuro/registration/tractogram/main.nf'
@@ -14,6 +15,7 @@
     take:
         ch_anat                     // channel: [ val(meta), [ anat ] ]
         ch_nifti_files              // channel: [ val(meta), [ nifti_files ] ]
+        ch_rgb_files                // channel: [ val(meta), [ rgb_files ] ]
         ch_mask_files               // channel: [ val(meta), [ mask_files ] ]
         ch_labels_files             // channel: [ val(meta), [ labels_files ] ]
         ch_trk_files                // channel: [ val(meta), [ trk_files ] ]
@@ -151,10 +153,17 @@
         | join(REGISTRATION_ANTS.out.image)
         | join(REGISTRATION_ANTS.out.warp)
         | join(REGISTRATION_ANTS.out.affine)
-
     WARPIMAGES ( ch_files_to_transform )
     ch_versions = ch_versions.mix(WARPIMAGES.out.versions)
 
+    // ** Same process for the rgb files ** //
+    ch_rgb_to_transform = ch_rgb_files
+        | join(REGISTRATION_ANTS.out.image)
+        | join(REGISTRATION_ANTS.out.warp)
+        | join(REGISTRATION_ANTS.out.affine)
+    WARPRGB ( ch_rgb_to_transform )
+    ch_versions = ch_versions.mix(WARPRGB.out.versions)
+
     // ** Same process for the masks ** //
     ch_masks_to_transform = ch_mask_files
         | join(REGISTRATION_ANTS.out.image)
@@ -177,7 +186,13 @@
         | join(REGISTRATION_ANTS.out.inverse_warp)
         | join(REGISTRATION_ANTS.out.affine)
         | map{ meta, trk, image, warp, affine ->
-            tuple(meta, image, affine, trk, [], warp)
+            // Calculate memory based on tractogram files size
+            def trk_files = [trk].flatten()
+            def total_size = trk_files.collect { it.size() }.sum()
+            def mem = ((4L * 1024 * 1024 * 1024) + total_size * 7.0)
+
+            // Return with memory in meta
+            tuple(meta + [mem: mem as long], image, affine, trk, [], warp)
         }
 
     REGISTRATION_TRACTOGRAM ( ch_tractograms_to_transform )
@@ -188,9 +203,9 @@
         ch_t2w_tpl                  = ch_t2w_tpl                                        // channel: [ tpl-T2w ]
         ch_registered_anat          = REGISTRATION_ANTS.out.image                       // channel: [ val(meta), [ image ] ]
         ch_warped_nifti_files       = WARPIMAGES.out.warped_image                       // channel: [ val(meta), [ warped_image ] ]
+        ch_rgb_nifti_files          = WARPRGB.out.warped_image                          // channel: [ val(meta), [ warped_rgb ] ]
         ch_warped_mask_files        = WARPMASK.out.warped_image                         // channel: [ val(meta), [ warped_mask ] ]
         ch_warped_labels_files      = WARPLABELS.out.warped_image                       // channel: [ val(meta), [ warped_labels ] ]
-        ch_warped_trk_files         = REGISTRATION_TRACTOGRAM.out.warped_tractogram     // channel: [ val(meta), [ warped_tractogram ] ]
+        ch_warped_trk_files         = REGISTRATION_TRACTOGRAM.out.tractogram            // channel: [ val(meta), [ warped_tractogram ] ]
         versions                    = ch_versions                                       // channel: [ versions.yml ]
 }
-

'subworkflows/nf-neuro/output_template_space/tests/main.nf.test.snap' is unchanged
'subworkflows/nf-neuro/output_template_space/tests/tags.yml' is unchanged
'subworkflows/nf-neuro/output_template_space/tests/nextflow.config' is unchanged
'subworkflows/nf-neuro/output_template_space/tests/main.nf.test' is unchanged
'subworkflows/nf-neuro/output_template_space/tests/nextflow_local.config' is unchanged
************************************************************
