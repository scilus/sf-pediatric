/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Config file for defining DSL2 per module options and publishing paths
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Available keys to override module options:
        ext.args   = Additional arguments appended to command in module.
        ext.args2  = Second set of arguments appended to command in module (multi-tool modules).
        ext.args3  = Third set of arguments appended to command in module (multi-tool modules).
        ext.prefix = File name prefix for output files.
----------------------------------------------------------------------------------------
*/

process {
    withName: ".*:TRACTOMETRY:TRACTOGRAM_REMOVEINVALID" {
        ext.suffix = "ri"
        ext.cut_invalid = true
        ext.remove_single_point = true
        ext.remove_overlapping_points = true
        ext.threshold = 0.001
        ext.no_empty = true
        publishDir = [
            path: { meta.session ? "${params.outdir}/${meta.id}/${meta.session}/dwi/" : "${params.outdir}/${meta.id}/dwi/" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename },
            enabled: params.lean_output ? false : true
        ]
    }
    withName: ".*:TRACTOMETRY:BUNDLE_FIXELAFD" {
        publishDir = [
            path: { meta.session ? "${params.outdir}/${meta.id}/${meta.session}/dwi/" : "${params.outdir}/${meta.id}/dwi/" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename },
            enabled: params.lean_output ? false : true
        ]
    }
    withName: ".*:TRACTOMETRY:TRACTOGRAM_RESAMPLE" {
        ext.nb_points = params.nb_points
        publishDir = [
            path: { meta.session ? "${params.outdir}/${meta.id}/${meta.session}/dwi/" : "${params.outdir}/${meta.id}/dwi/" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename },
            enabled: params.lean_output ? false : true
        ]
    }
    withName: ".*:TRACTOMETRY:BUNDLE_CENTROID" {
        ext.nb_points = params.nb_points
        publishDir = [
            path: { meta.session ? "${params.outdir}/${meta.id}/${meta.session}/dwi/" : "${params.outdir}/${meta.id}/dwi/" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename },
            enabled: params.lean_output ? false : true
        ]
    }
    withName: ".*:TRACTOMETRY:BUNDLE_LABELMAP" {
        ext.nb_points = params.nb_points
        ext.colormap = params.colormap
        ext.hyperplane = params.use_hyperplane
        ext.manhattan = params.use_manhattan
        publishDir = [
            path: { meta.session ? "${params.outdir}/${meta.id}/${meta.session}/dwi/" : "${params.outdir}/${meta.id}/dwi/" },
            mode: params.publish_dir_mode,
            saveAs: { filename -> filename.equals('versions.yml') ? null : filename },
            enabled: params.lean_output ? false : true
        ]
    }
    withName: ".*:TRACTOMETRY:BUNDLE_UNIFORMIZE" {
        publishDir = [
            path: { meta.session ? "${params.outdir}/${meta.id}/${meta.session}/dwi/bundles/" : "${params.outdir}/${meta.id}/dwi/bundles/" },
            mode: params.publish_dir_mode,
            saveAs: {
                filename ->
                def ses = meta.session ? "${meta.session}_" : ""
                if ( filename.contains("AC_labels") ) { "${meta.id}_${ses}tract-AnteriorCommisure_track-sdstream_tractogram.trk" }
                else if ( filename.contains("AF_L") ) { "${meta.id}_${ses}tract-ArcuateFasciculus_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("AF_R") ) { "${meta.id}_${ses}tract-ArcuateFasciculus_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CC_Fr_1") ) { "${meta.id}_${ses}tract-CorpusCallosumFrontal1_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CC_Fr_2") ) { "${meta.id}_${ses}tract-CorpusCallosumFrontal2_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CC_Oc") ) { "${meta.id}_${ses}tract-CorpusCallosumOccipital_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CC_Pa") ) { "${meta.id}_${ses}tract-CorpusCallosumParietal_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CC_Pr_Po") ) { "${meta.id}_${ses}tract-CorpusCallosumPrecentralPostcentral_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CC_Te") ) { "${meta.id}_${ses}tract-CorpusCallosumTemporal_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CG_L_An") ) { "${meta.id}_${ses}tract-CingulumAnterior_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CG_L_curve") ) { "${meta.id}_${ses}tract-CingulumCurve_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CG_L_Po") ) { "${meta.id}_${ses}tract-CingulumPosterior_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CG_L_labels") ) { "${meta.id}_${ses}tract-Cingulum_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CG_R_An") ) { "${meta.id}_${ses}tract-CingulumAnterior_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CG_R_curve") ) { "${meta.id}_${ses}tract-CingulumCurve_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CG_R_Po") ) { "${meta.id}_${ses}tract-CingulumPosterior_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("CG_R_labels") ) { "${meta.id}_${ses}tract-Cingulum_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("FAT_L") ) { "${meta.id}_${ses}tract-FrontalAslantTract_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("FAT_R") ) { "${meta.id}_${ses}tract-FrontalAslantTract_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("FPT_L_Brainstem") ) { "${meta.id}_${ses}tract-FrontoPontineTractBrainstem_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("FPT_L_labels") ) { "${meta.id}_${ses}tract-FrontoPontineTract_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("FPT_R_Brainstem") ) { "${meta.id}_${ses}tract-FrontoPontineTractBrainstem_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("FPT_R_labels") ) { "${meta.id}_${ses}tract-FrontoPontineTract_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("FX_L") ) { "${meta.id}_${ses}tract-Fornix_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("FX_R") ) { "${meta.id}_${ses}tract-Fornix_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("ICP_L") ) { "${meta.id}_${ses}tract-InferiorCerebellarPeduncle_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("ICP_R") ) { "${meta.id}_${ses}tract-InferiorCerebellarPeduncle_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("IFOF_L") ) { "${meta.id}_${ses}tract-InferiorFrontoOccipitalFasciculus_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("IFOF_R") ) { "${meta.id}_${ses}tract-InferiorFrontoOccipitalFasciculus_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("ILF_L") ) { "${meta.id}_${ses}tract-InferiorLongitudinalFasciculus_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("ILF_R") ) { "${meta.id}_${ses}tract-InferiorLongitudinalFasciculus_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("MCP") ) { "${meta.id}_${ses}tract-MiddleCerebellarPeduncle_track-sdstream_tractogram.trk" }
                else if ( filename.contains("MdLF_L") ) { "${meta.id}_${ses}tract-MiddleLongitudinalFascicle_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("MdLF_R") ) { "${meta.id}_${ses}tract-MiddleLongitudinalFascicle_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("OR_ML_L") ) { "${meta.id}_${ses}tract-OpticRadiationMeyersLoop_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("OR_ML_R") ) { "${meta.id}_${ses}tract-OpticRadiationMeyersLoop_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("PC_labels") ) { "${meta.id}_${ses}tract-PosteriorCommisure_track-sdstream_tractogram.trk" }
                else if ( filename.contains("POPT_L_Brainstem") ) { "${meta.id}_${ses}tract-ParietoOccipitoPontineTractBrainstem_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("POPT_R_Brainstem") ) { "${meta.id}_${ses}tract-ParietoOccipitoPontineTractBrainstem_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("POPT_L_labels") ) { "${meta.id}_${ses}tract-ParietoOccipitoPontineTract_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("POPT_R_labels") ) { "${meta.id}_${ses}tract-ParietoOccipitoPontineTract_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("PYT_L_Brainstem") ) { "${meta.id}_${ses}tract-PyramidalTractBrainstem_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("PYT_R_Brainstem") ) { "${meta.id}_${ses}tract-PyramidalTractBrainstem_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("PYT_L") ) { "${meta.id}_${ses}tract-PyramidalTract_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("PYT_R") ) { "${meta.id}_${ses}tract-PyramidalTract_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("SCP_L") ) { "${meta.id}_${ses}tract-SuperiorCerebellarPeduncle_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("SCP_R") ) { "${meta.id}_${ses}tract-SuperiorCerebellarPeduncle_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("SLF_L") ) { "${meta.id}_${ses}tract-SuperiorLongitudinalFasciculus_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("SLF_R") ) { "${meta.id}_${ses}tract-SuperiorLongitudinalFasciculus_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("UF_L") ) { "${meta.id}_${ses}tract-UncinateFasciculus_hemi-left_track-sdstream_tractogram.trk" }
                else if ( filename.contains("UF_R") ) { "${meta.id}_${ses}tract-UncinateFasciculus_hemi-right_track-sdstream_tractogram.trk" }
                else if ( filename.contains("versions.yml") ) { null }
                else { params.lean_output ? null : filename }
            }
        ]
    }
    withName: ".*:TRACTOMETRY:BUNDLE_STATS" {
        ext.density_weighting = params.density_weighting
        ext.normalize_weights = params.normalize_weights
        ext.length_stats = params.length_stats
        ext.endpoints = params.endpoints_stats
        ext.streamline_count = params.streamline_count
        ext.mean_std = params.means_std
        ext.volume = params.volume
        ext.streamline_count = params.streamline_count
        ext.volume_per_labels = params.volume_per_labels
        ext.mean_std_per_point = params.mean_std_per_point
        ext.lesions_stats = false
        publishDir = [
            path: { meta.session ? "${params.outdir}/${meta.id}/${meta.session}/dwi/" : "${params.outdir}/${meta.id}/dwi/" },
            mode: params.publish_dir_mode,
            saveAs: {
                filename ->
                def ses = meta.session ? "${meta.session}_" : ""
                if ( filename.contains("length_stats.json") ) { "${meta.id}_${ses}desc-length_stats.json" }
                else if ( filename.contains("desc-mean_stats.tsv") ) { "${meta.id}_${ses}desc-mean_stats.tsv" }
                else if ( filename.contains("desc-point_stats.tsv") ) { "${meta.id}_${ses}desc-point_stats.tsv" }
                else if ( filename.contains("endpoints_map_raw.json") ) { "${meta.id}_${ses}desc-endpoints_map_raw_stats.json" }
                else if ( filename.contains("endpoints_metric_stats.json") ) { "${meta.id}_${ses}desc-endpoints_metric_stats.json" }
                else if ( filename.contains("mean_std_stats.json") ) { "${meta.id}_${ses}desc-mean_std_stats.json" }
                else if ( filename.contains("volume.json") ) { "${meta.id}_${ses}desc-volume_stats.json" }
                else if ( filename.contains("volume_lesions.json") ) { "${meta.id}_${ses}desc-volume_lesions_stats.json" }
                else if ( filename.contains("streamline_count.json") ) { "${meta.id}_${ses}desc-streamline_count.json" }
                else if ( filename.contains("streamline_count_lesions.json") ) { "${meta.id}_${ses}desc-streamline_count_lesions.json" }
                else if ( filename.contains("volume_per_label.json") ) { "${meta.id}_${ses}desc-volume_per_label.json" }
                else if ( filename.contains("volume_per_label_lesions.json") ) { "${meta.id}_${ses}desc-volume_per_label_lesions.json" }
                else if ( filename.contains("mean_std_per_point_stats.json") ) { "${meta.id}_${ses}desc-mean_std_per_point.json" }
                else if ( filename.contains("lesions_stats.json") ) { "${meta.id}_${ses}desc-lesions_stats.json" }
                else if ( filename.contains("lesion_map") ) { "${meta.id}_${ses}desc-lesions_map.nii.gz" }
                else if ( filename.contains("versions.yml") ) { null }
                else { params.lean_output ? null : filename }
            }
        ]
    }
}
